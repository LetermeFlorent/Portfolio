<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Florent Leterme | Portfolio</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- VARIABLES & CONFIG --- */
        :root {
            --bg-deep: #000000;
            --text-main: #ffffff;
            --text-muted: #cbd5e1;
            --col-academic: #3b82f6; 
            --col-creative: #a855f7; 
            --col-divine: #ffd700; 
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--bg-deep);
            color: var(--text-main);
            font-family: 'Outfit', sans-serif;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* --- ARRI√àRE-PLAN 3D --- */
        #canvas-container {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            z-index: -1; background: #000;
        }

        /* --- AUDIO CONTROL --- */
        #audio-toggle {
            position: fixed; bottom: 30px; right: 30px; z-index: 100;
            background: rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.2);
            color: white; padding: 10px; border-radius: 50%; width: 40px; height: 40px;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: 0.3s; opacity: 0.5;
        }
        #audio-toggle:hover { opacity: 1; background: var(--col-academic); border-color: var(--col-academic); }
        #audio-toggle.muted { opacity: 0.3; }

        /* Audio permission overlay */
        #audio-permission {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 10000; display: flex;
            align-items: center; justify-content: center; flex-direction: column;
            backdrop-filter: blur(10px);
        }
        .permission-box {
            background: rgba(30,30,30,0.95); padding: 3rem; border-radius: 20px;
            border: 1px solid var(--col-academic); text-align: center; max-width: 500px;
            margin: 2rem;
        }
        .permission-box h3 { color: var(--col-academic); margin-bottom: 1rem; }
        .permission-box p { margin-bottom: 2rem; color: #ccc; }
        .permission-btn {
            background: var(--col-academic); color: white; border: none;
            padding: 12px 30px; border-radius: 8px; cursor: pointer;
            font-size: 1.1rem; font-weight: bold; transition: 0.3s;
        }
        .permission-btn:hover { background: #2563eb; transform: translateY(-2px); }

        main { position: relative; z-index: 1; }

        section {
            min-height: 100vh; display: flex; flex-direction: column; justify-content: center;
            padding: 2rem 10%; position: relative; pointer-events: none;
        }

        /* --- HUD / CINEMA 3D CARD --- */
        .glass-card {
            pointer-events: auto;
            background: rgba(255, 255, 255, 0.01);
            backdrop-filter: blur(2px); -webkit-backdrop-filter: blur(2px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-left: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: none; border-radius: 24px; padding: 4rem; max-width: 1100px;
            position: relative; overflow: hidden;
            opacity: 0; transform: scale(0.95) translateY(30px);
            will-change: transform, opacity, background-color, box-shadow;
        }
        .glass-card:hover { border-color: rgba(255, 255, 255, 0.3); background: rgba(255, 255, 255, 0.02); }

        /* Typo */
        h1 { font-size: clamp(2.5rem, 6vw, 5rem); font-weight: 900; margin-bottom: 1rem; line-height: 1.1; color: #fff; text-shadow: 0 4px 20px rgba(0,0,0,1); }
        h2 { font-size: 1.8rem; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 12px; text-shadow: 0 2px 10px rgba(0,0,0,0.8); }
        h3 { font-size: 1.2rem; margin-bottom: 0.5rem; color: #fff; font-weight: 700; text-shadow: 0 2px 5px rgba(0,0,0,0.8); }
        p { color: var(--text-muted); line-height: 1.7; font-size: 1.1rem; margin-bottom: 1.5rem; font-weight: 500; text-shadow: 0 2px 4px rgba(0,0,0,0.9); }
        .subtitle { font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 4px; color: #fff; margin-bottom: 1rem; display: block; text-shadow: 0 0 10px var(--col-academic); }

        /* Boutons */
        .cv-actions { display: flex; gap: 15px; margin-top: 35px; padding-top: 25px; border-top: 1px solid rgba(255,255,255,0.1); }
        .btn-cv {
            cursor: pointer; display: inline-flex; align-items: center; justify-content: center; gap: 10px;
            padding: 14px 28px; border-radius: 4px; font-weight: 700; font-size: 0.95rem; text-transform: uppercase; letter-spacing: 1px;
            text-decoration: none; transition: all 0.3s ease; background: rgba(0, 0, 0, 0.4); border: 1px solid rgba(255, 255, 255, 0.3); color: #fff; backdrop-filter: blur(4px);
        }
        .btn-cv:hover { background: rgba(255, 255, 255, 0.1); border-color: #fff; box-shadow: 0 0 15px rgba(255,255,255,0.3); }
        .btn-cv.primary { background: rgba(255, 255, 255, 0.1); border-color: var(--col-academic); color: #fff; }
        .btn-cv.primary:hover { background: var(--col-academic); border-color: var(--col-academic); box-shadow: 0 0 25px var(--col-academic); }
        .btn-cv.github-pro { background: rgba(255, 255, 255, 0.1); border-color: var(--col-academic); color: #fff; }
        .btn-cv.github-pro:hover { background: var(--col-academic); border-color: var(--col-academic); box-shadow: 0 0 25px var(--col-academic); }
        .btn-cv.github-exp { background: rgba(255, 255, 255, 0.1); border-color: var(--col-creative); color: var(--col-creative); }
        .btn-cv.github-exp:hover { background: var(--col-creative); border-color: var(--col-creative); color: #fff; box-shadow: 0 0 25px var(--col-creative); }

        /* Grid */
        .xp-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 25px; }
        .xp-item { background: rgba(0, 0, 0, 0.3); padding: 1.5rem; border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.08); transition: 0.3s; will-change: transform, background-color; }
        .xp-item:hover { background: rgba(255, 255, 255, 0.05); border-color: rgba(255, 255, 255, 0.4); transform: translateY(-5px); }
        .xp-date { font-size: 0.75rem; font-weight: 700; color: var(--col-academic); display: block; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px; text-shadow: 0 0 5px rgba(37, 99, 235, 0.5); }

        /* Navigation entre sections */
        .section-nav {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding-top: 25px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        /* Modal */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0, 0, 0, 0.95); z-index: 9999; opacity: 0; align-items: center; justify-content: center; }
        .cv-document-wrapper { width: 900px; max-width: 95vw; height: 90vh; background: #151515; border: 1px solid #444; border-radius: 12px; display: flex; flex-direction: column; box-shadow: 0 0 50px rgba(0,0,0,1); }
        .cv-header-toolbar { padding: 15px 25px; background: #222; border-bottom: 1px solid #444; display: flex; justify-content: space-between; align-items: center; }
        .cv-scroll-area { flex: 1; overflow-y: auto; padding: 50px; background: #151515; }
        .cv-container { color: #e0e0e0; font-family: 'Helvetica', 'Arial', sans-serif; }
        .cv-top-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px solid var(--col-academic); }
        .cv-name h1 { font-size: 2.5rem; margin: 0; line-height: 1; color: #fff; text-shadow: none; }
        .cv-name h2 { font-size: 1.2rem; color: var(--col-academic); font-weight: 500; margin: 5px 0 0 0; text-shadow: none; }
        .cv-contact { text-align: right; font-size: 0.9rem; line-height: 1.6; color: #aaa; text-shadow: none; }
        .cv-contact a { color: #fff; text-decoration: none; border-bottom: 1px solid #444; }
        .cv-section-title { font-family: 'JetBrains Mono'; font-weight: 700; color: #fff; background: rgba(59, 130, 246, 0.15); padding: 8px 12px; border-left: 3px solid var(--col-academic); margin: 25px 0 15px 0; text-transform: uppercase; font-size: 1rem; text-shadow: none; }
        .cv-entry { margin-bottom: 20px; border-left: 1px solid #444; padding-left: 15px; }
        .cv-entry-header { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 5px; }
        .cv-job-title { font-size: 1.1rem; font-weight: 700; color: #fff; text-shadow: none; }
        .cv-date { font-family: 'JetBrains Mono'; font-size: 0.85rem; color: var(--col-academic); text-shadow: none; }
        .cv-company { font-style: italic; color: #aaa; font-size: 0.95rem; display: block; margin-bottom: 5px; text-shadow: none;}
        .cv-list { padding-left: 20px; margin: 0; }
        .cv-list li { margin-bottom: 4px; color: #ccc; font-size: 0.95rem; line-height: 1.4; text-shadow: none; }
        .cv-skills-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; }
        .skill-category { margin-bottom: 10px; }
        .skill-title { font-size: 0.9rem; font-weight: 700; color: #fff; margin-bottom: 8px; display: block; text-shadow: none; }
        .tag-container { display: flex; flex-wrap: wrap; gap: 8px; }
        .tag { font-family: 'JetBrains Mono'; font-size: 0.75rem; padding: 4px 8px; border-radius: 4px; background: #222; border: 1px solid #444; color: #ddd; text-shadow: none; }
        .tag.highlight { border-color: var(--col-academic); color: #fff; background: rgba(59, 130, 246, 0.2); }

        /* Footer */
        footer { margin-top: 20vh; padding: 4rem 2rem; background: linear-gradient(to top, #050505 0%, transparent 100%); border-top: 1px solid rgba(255, 255, 255, 0.05); text-align: center; position: relative; z-index: 2; pointer-events: auto; }
        .footer-links { display: flex; justify-content: center; gap: 20px; margin: 30px 0; flex-wrap: wrap; }
        .footer-btn { display: inline-flex; align-items: center; gap: 8px; padding: 10px 20px; background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 4px; color: var(--text-muted); text-decoration: none; font-size: 0.9rem; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; transition: all 0.3s ease; backdrop-filter: blur(2px); }
        .footer-btn:hover { background: rgba(255, 255, 255, 0.1); border-color: #fff; color: #fff; box-shadow: 0 0 15px rgba(255, 255, 255, 0.2); transform: translateY(-2px); }
        .copyright { font-size: 0.8rem; color: #555; text-transform: uppercase; letter-spacing: 2px; }

        @media (max-width: 768px) {
            section { padding: 4rem 5%; }
            .cv-actions { flex-direction: column; }
            .btn-cv, .footer-btn { width: 100%; justify-content: center; }
            .cv-top-header { flex-direction: column; gap: 20px; }
            .cv-contact { text-align: left; }
            .glass-card { padding: 2rem; }
            .section-nav { flex-direction: column; gap: 15px; }
            .permission-box { padding: 2rem; margin: 1rem; }
        }
    </style>
</head>
<body>

    <!-- Overlay de permission audio -->
    <div id="audio-permission">
        <div class="permission-box">
            <h3>üéµ Exp√©rience Audio Immersive</h3>
            <p>Ce portfolio inclut une bande-son spatiale 3D pour une exp√©rience compl√®te. L'audio ne jouera qu'apr√®s votre autorisation.</p>
            <button id="enable-audio" class="permission-btn">Activer l'audio immersif</button>
            <p style="margin-top: 1rem; font-size: 0.9rem; opacity: 0.7;">Vous pourrez couper le son √† tout moment</p>
        </div>
    </div>

    <div id="canvas-container"></div>

    <!-- AUDIO TOGGLE -->
    <div id="audio-toggle" class="muted" title="Activer/D√©sactiver le son">üîá</div>

    <!-- MODALE CV -->
    <div id="cv-modal" class="modal-overlay">
        <div class="cv-document-wrapper">
            <div class="cv-header-toolbar">
                <span style="color:#aaa; font-family:'JetBrains Mono';">Aper√ßu du CV</span>
                <div style="display:flex; gap:10px;">
                    <button id="print-html-btn" class="btn-cv" style="height:auto; padding:8px 16px; font-size:0.8rem; background:#333; border:1px solid #555;">üñ®Ô∏è Imprimer</button>
                    <button id="close-modal-btn" style="background:none; border:none; color:white; font-size:1.5rem; cursor:pointer;">‚úï</button>
                </div>
            </div>
            <div class="cv-scroll-area" id="printable-area">
                <div class="cv-container">
                    <div class="cv-top-header">
                        <div class="cv-name"><h1>Florent Leterme</h1><h2>D√©veloppeur Web & Logiciel</h2></div>
                        <div class="cv-contact">37380 Reugny<br>06 88 68 59 70<br><a href="mailto:letermeflorent@gmail.com">letermeflorent@gmail.com</a><br><a href="https://github.com/LetermeFlorent" target="_blank">GitHub/LetermeFlorent</a><br>Permis B</div>
                    </div>
                    <div class="cv-section-title">Exp√©riences (Projets & Stages)</div>
                    <div class="cv-entry"><div class="cv-entry-header"><span class="cv-job-title">Am√©lioration Intranet M√©decins</span><span class="cv-date">2024 - 2025</span></div><span class="cv-company">CHU de Tours (Projet BTS)</span><ul class="cv-list"><li>Am√©lioration des fonctionnalit√©s existantes et ajout de nouvelles features sur le site intranet des m√©decins.</li><li>Refonte UX/UI pour optimiser le parcours utilisateur.</li></ul></div>
                    <div class="cv-entry"><div class="cv-entry-header"><span class="cv-job-title">Site Intranet du CHU</span><span class="cv-date">2023 - 2024</span></div><span class="cv-company">CHU de Tours (Projet BTS)</span><ul class="cv-list"><li>Analyse et refonte compl√®te de l'intranet destin√© aux m√©decins.</li><li>Correction des redirections, am√©lioration de la navigation et de l'ergonomie.</li><li>Travail en √©quipe (m√©thodes agiles simul√©es).</li></ul></div>
                    <div class="cv-entry"><div class="cv-entry-header"><span class="cv-job-title">Simple Storage (App Gestion)</span><span class="cv-date">2023 - 2024</span></div><span class="cv-company">Projet BTS</span><ul class="cv-list"><li>D√©veloppement d'une application web de gestion de stock simple (CRUD) avec listing et ajout d'articles.</li><li>Utilisation de PHP, PostgreSQL, et HTML/CSS.</li><li>Int√©gration de la librairie <strong>FakerPHP</strong> pour la g√©n√©ration de donn√©es de test.</li></ul></div>
                    <div class="cv-entry"><div class="cv-entry-header"><span class="cv-job-title">Site Web Lyc√©e</span><span class="cv-date">2023 - 2024</span></div><span class="cv-company">Projet BTS</span><ul class="cv-list"><li>Participation au d√©veloppement du site web du lyc√©e en √©quipe de cinq.</li><li>Responsable de la cr√©ation de pages fonctionnelles, esth√©tiques et conviviales.</li><li>Technologies : HTML, CSS, PHP (basique).</li></ul></div>
                    <div class="cv-entry"><div class="cv-entry-header"><span class="cv-job-title">Stage D√©veloppeur</span><span class="cv-date">Loches, 2022 - 2023</span></div><span class="cv-company">PC4You</span><ul class="cv-list"><li>Mise √† jour et maintenance du CRM <strong>Dolibarr</strong>.</li><li>Modification d'√©l√©ments sur un module de gestion de stock.</li></ul></div>
                    <div class="cv-section-title">Formation</div>
                    <div class="cv-entry" style="margin-bottom:10px; border:none; padding-left:0;"><div class="cv-entry-header"><span class="cv-job-title">BTS SIO SLAM</span><span class="cv-date">2025 (En cours)</span></div><span class="cv-company">Lyc√©e Guy Chauvet, Loudun</span><p style="margin:0; font-size:0.9rem; color:#888;">Solutions Logicielles et Applications M√©tiers</p></div>
                    <div class="cv-entry" style="margin-bottom:10px; border:none; padding-left:0;"><div class="cv-entry-header"><span class="cv-job-title">BAC STI2D SIN</span><span class="cv-date">2022</span></div><span class="cv-company">Lyc√©e Jacques de Vaucanson, Tours</span><p style="margin:0; font-size:0.9rem; color:#888;">Syst√®mes d'Information et Num√©rique</p></div>
                    <div class="cv-section-title">Comp√©tences Techniques</div>
                    <div class="cv-skills-grid"><div class="skill-category"><span class="skill-title">Langages</span><div class="tag-container"><span class="tag highlight">PHP</span><span class="tag highlight">Java</span><span class="tag">SQL</span><span class="tag">HTML5/CSS3</span></div></div><div class="skill-category"><span class="skill-title">Frameworks</span><div class="tag-container"><span class="tag highlight">PostgreSQL</span><span class="tag">MySQL</span><span class="tag">FakerPHP</span></div></div><div class="skill-category"><span class="skill-title">Outils</span><div class="tag-container"><span class="tag highlight">Git</span><span class="tag">VS Code</span><span class="tag">IntelliJ</span></div></div></div>
                </div>
            </div>
        </div>
    </div>

    <main>
        <section id="hero">
            <div class="glass-card">
                <span class="subtitle" style="color: var(--col-academic);">System Online</span>
                <h1>Florent Leterme</h1>
                <h2 style="font-weight: 300; color: #ddd;">D√©veloppeur <span style="color:white; font-weight:700;">Fullstack</span> & <span style="color:white; font-weight:700;">Logiciel</span></h2>
                <p>√âtudiant en BTS SIO SLAM. Je con√ßois des architectures robustes.<br>Rigueur acad√©mique le jour, exp√©rimentations techniques la nuit.</p>
                <div class="cv-actions" style="border-top:none; margin-top:20px; padding-top:0;">
                    <a href="#academic" class="btn-cv primary">Initialiser le Profil</a>
                </div>
            </div>
        </section>

        <section id="academic">
            <div class="glass-card">
                <span class="subtitle" style="color: var(--col-academic);">Data Log: Professionnel</span>
                <h2>üéì Parcours & Comp√©tences</h2>
                <div class="xp-grid">
                    <div class="xp-item"><span class="xp-date">2023 - 2025</span><h3>CHU de Tours</h3><p style="font-size: 0.9rem;">Refonte Intranet M√©decins (Agile).</p></div>
                    <div class="xp-item"><span class="xp-date">Projet BTS</span><h3>Simple Storage</h3><p style="font-size: 0.9rem;">App Fullstack PHP/PostgreSQL.</p></div>
                    <div class="xp-item"><span class="xp-date">Stack</span><h3>Technologies</h3><p style="font-size: 0.9rem; font-family:'JetBrains Mono'; color:#fff;">PHP ‚Ä¢ Java ‚Ä¢ SQL ‚Ä¢ Git</p></div>
                </div>
                <div class="cv-actions">
                    <a href="cv.pdf" download class="btn-cv primary">Download Data (PDF)</a>
                    <button id="open-modal-btn" class="btn-cv">View Source (HTML)</button>
                    <a href="https://github.com/LetermeFlorent" target="_blank" class="btn-cv github-pro">GitHub Pro</a>
                </div>
                <div class="section-nav">
                    <a href="#hero" class="btn-cv">‚Üë Retour au D√©but</a>
                    <a href="#creative" class="btn-cv">Prochain Profil ‚Üì</a>
                </div>
            </div>
        </section>

        <section id="creative">
            <div class="glass-card" style="border-top: 1px solid var(--col-creative);">
                <span class="subtitle" style="color: var(--col-creative);">Labo Exp√©rimental</span>
                <h2>üß™ Projets @Dreyka-Oas</h2>
                <p>D√©veloppement moteurs de jeux, outils syst√®mes et interfaces.</p>
                <div class="xp-grid">
                    <div class="xp-item"><h3>SpacePanel</h3><p style="font-size: 0.9rem;">Dashboard Node.js/Socket.io TR.</p></div>
                    <div class="xp-item"><h3>LogoCreator</h3><p style="font-size: 0.9rem;">Python GUI Generator.</p></div>
                    <div class="xp-item"><h3>Game Dev</h3><p style="font-size: 0.9rem;">JS Canvas Engine.</p></div>
                </div>
                <div class="cv-actions" style="border-top: none; margin-top: 35px; padding-top: 0;">
                    <a href="https://github.com/Dreyka-Oas" target="_blank" class="btn-cv github-exp">GitHub Exp√©rimental</a>
                </div>
                <div class="section-nav">
                    <a href="#academic" class="btn-cv">‚Üë Profil Pr√©c√©dent</a>
                    <a href="#hero" class="btn-cv">Retour au D√©but ‚Üë</a>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="footer-content">
            <h3 style="opacity: 0.7;">Florent Leterme</h3>
            <div class="footer-links">
                <a href="https://www.linkedin.com/in/leterme-florent/" target="_blank" class="footer-btn">LinkedIn</a>
                <a href="https://github.com/LetermeFlorent" target="_blank" class="footer-btn">GitHub Pro</a>
                <a href="https://github.com/Dreyka-Oas" target="_blank" class="footer-btn">GitHub Exp</a>
                <a href="mailto:letermeflorent@gmail.com" class="footer-btn">Contact</a>
            </div>
            <p class="copyright">¬© 2025 Florent Leterme. System Verified.</p>
        </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollToPlugin.min.js"></script>

    <script>
        // --- GLOBAL VARS ---
        const modal = document.getElementById('cv-modal'); 
        const body = document.body;
        const audioPermissionOverlay = document.getElementById('audio-permission');
        gsap.registerPlugin(ScrollTrigger, ScrollToPlugin);

        // --- AUDIO SYSTEM AVEC FICHIERS MP3 ---
        const soundManager = {
            enabled: false,
            context: null,
            sounds: {},
            muted: true,
            buffers: {},
            
            init: function() {
                if (this.context) return;
                
                try {
                    const AudioContext = window.AudioContext || window.webkitAudioContext;
                    this.context = new AudioContext();
                    
                    // Charger les fichiers audio
                    this.loadAudioFiles();
                    
                    console.log("Syst√®me audio initialis√© avec fichiers MP3");
                    return true;
                } catch (e) {
                    console.warn("Audio non support√©:", e);
                    return false;
                }
            },
            
            loadAudioFiles: function() {
                // URLs de vos fichiers audio
                const audioFiles = {
                    ambience: 'ambience.mp3',
                    explosion: 'explosion.mp3',
                    flyby: 'flyby.mp3'
                };

                // Fonction pour charger un fichier audio
                const loadAudio = (name, url) => {
                    return fetch(url)
                        .then(response => response.arrayBuffer())
                        .then(arrayBuffer => this.context.decodeAudioData(arrayBuffer))
                        .then(audioBuffer => {
                            this.buffers[name] = audioBuffer;
                            console.log(`Audio ${name} charg√©`);
                        })
                        .catch(error => console.error(`Erreur chargement ${name}:`, error));
                };

                // Charger tous les fichiers
                Promise.all([
                    loadAudio('ambience', audioFiles.ambience),
                    loadAudio('explosion', audioFiles.explosion),
                    loadAudio('flyby', audioFiles.flyby)
                ]).then(() => {
                    console.log("Tous les fichiers audio sont charg√©s");
                });
            },
            
            playSound: function(name, loop = false, volume = 1.0) {
                if (!this.enabled || this.muted || !this.buffers[name]) return null;
                
                try {
                    const source = this.context.createBufferSource();
                    const gainNode = this.context.createGain();
                    
                    source.buffer = this.buffers[name];
                    source.loop = loop;
                    gainNode.gain.value = volume;
                    
                    source.connect(gainNode);
                    gainNode.connect(this.context.destination);
                    
                    source.start(0);
                    return { source, gainNode };
                } catch (e) {
                    console.error("Erreur lecture audio:", e);
                    return null;
                }
            },
            
            playAmbience: function() {
                if (this.sounds.ambience) {
                    this.sounds.ambience.source.stop();
                }
                this.sounds.ambience = this.playSound('ambience', true, 0.3);
            },
            
            playExplosion: function() {
                this.playSound('explosion', false, 0.7);
            },
            
            playFlyby: function() {
                this.playSound('flyby', false, 0.5);
            },
            
            enable: function() {
                if (!this.context) {
                    if (!this.init()) return false;
                }
                
                // Reprendre le contexte audio si suspendu
                if (this.context.state === 'suspended') {
                    this.context.resume();
                }
                
                this.enabled = true;
                this.muted = false;
                
                // D√©marrer l'ambiance si le buffer est charg√©
                if (this.buffers.ambience) {
                    this.playAmbience();
                } else {
                    // Si pas encore charg√©, attendre un peu
                    setTimeout(() => {
                        if (this.buffers.ambience && this.enabled && !this.muted) {
                            this.playAmbience();
                        }
                    }, 1000);
                }
                
                console.log("Audio activ√© avec fichiers MP3");
                return true;
            },
            
            toggleMute: function() {
                if (!this.enabled) return;
                
                this.muted = !this.muted;
                
                // Arr√™ter ou red√©marrer l'ambiance selon le mute
                if (this.muted) {
                    if (this.sounds.ambience) {
                        this.sounds.ambience.source.stop();
                        this.sounds.ambience = null;
                    }
                } else {
                    if (this.buffers.ambience) {
                        this.playAmbience();
                    }
                }
                
                console.log("Audio " + (this.muted ? "muet" : "activ√©"));
                return this.muted;
            }
        };

        // Gestion de la permission audio
        document.getElementById('enable-audio').addEventListener('click', function() {
            if (soundManager.enable()) {
                // Cacher l'overlay de permission avec une animation
                gsap.to(audioPermissionOverlay, {
                    opacity: 0,
                    duration: 0.5,
                    onComplete: () => {
                        audioPermissionOverlay.style.display = 'none';
                    }
                });
                
                // Mettre √† jour le bouton audio
                muteBtn.innerHTML = 'üîä';
                muteBtn.classList.remove('muted');
            }
        });

        // Gestion du bouton mute
        const muteBtn = document.getElementById('audio-toggle');
        muteBtn.addEventListener('click', () => {
            if (!soundManager.enabled) {
                // Si l'audio n'est pas encore activ√©, l'activer
                soundManager.enable();
                muteBtn.innerHTML = 'üîä';
                muteBtn.classList.remove('muted');
                audioPermissionOverlay.style.display = 'none';
            } else {
                // Sinon, toggle mute
                const isMuted = soundManager.toggleMute();
                muteBtn.innerHTML = isMuted ? 'üîá' : 'üîä';
                muteBtn.classList.toggle('muted', isMuted);
            }
        });

        // --- 3D SCENE SETUP ---
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x000000, 0.001); 
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        
        const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true, powerPreference: "high-performance" });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        container.appendChild(renderer.domElement);

        const spaceGroup = new THREE.Group();
        scene.add(spaceGroup);

        // --- STARS ---
        const starsGeo = new THREE.BufferGeometry();
        const starsCnt = 600; 
        const posArray = new Float32Array(starsCnt * 3);
        
        for(let i = 0; i < starsCnt * 3; i += 3) {
            posArray[i] = (Math.random() - 0.5) * 200;     
            posArray[i + 1] = (Math.random() - 0.5) * 200; 
            posArray[i + 2] = (Math.random() - 0.5) * 200; 
        }
        
        starsGeo.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
        const starsMat = new THREE.PointsMaterial({ color: 0xffffff, size: 0.15, transparent: true, opacity: 0.8, blending: THREE.AdditiveBlending, sizeAttenuation: true });
        const starMesh = new THREE.Points(starsGeo, starsMat);
        scene.add(starMesh);

        // --- SUN SYSTEM ---
        const suns = []; 
        const sunData = new Map(); 
        let explosionCounter = 0;
        let secondSunSpawned = false;

        // SHOOTING STARS
        const shootingStars = [];
        let lastShootingStarTime = 0;
        const shootingStarInterval = 6000; 

        function createSunTexture() {
            const c = document.createElement('canvas'); c.width = 64; c.height = 64;
            const ctx = c.getContext('2d');
            const g = ctx.createRadialGradient(32, 32, 0, 32, 32, 32);
            g.addColorStop(0, 'rgba(255,255,255,1)'); 
            g.addColorStop(0.3, 'rgba(200,220,255,0.5)'); 
            g.addColorStop(1, 'rgba(0,0,0,0)');
            ctx.fillStyle = g; ctx.fillRect(0,0,64,64);
            return new THREE.CanvasTexture(c);
        }

        function spawnSun(x, y, z, isMain) {
            const sunMat = new THREE.SpriteMaterial({ map: createSunTexture(), color: 0xffffff, blending: THREE.AdditiveBlending, depthWrite: false, transparent: true });
            const sun = new THREE.Sprite(sunMat); 
            sun.scale.set(0.1, 0.1, 1); 
            sun.position.set(x, y, z);
            scene.add(sun);
            suns.push(sun);

            const sunLight = new THREE.PointLight(0xffffff, 0.1, 200); 
            sunLight.position.set(x, y, z + 10);
            scene.add(sunLight);

            const shockSphereGeo = new THREE.SphereGeometry(1, 32, 32);
            const shockSphereMat = new THREE.MeshBasicMaterial({ color: 0xffffff, transparent: true, opacity: 0, blending: THREE.AdditiveBlending, side: THREE.BackSide, depthWrite: false });
            const shockSphere = new THREE.Mesh(shockSphereGeo, shockSphereMat);
            shockSphere.position.copy(sun.position);
            scene.add(shockSphere);

            const instability = {
                lightIntensity: 2, baseScale: 80, pulseSpeed: 0.5 + Math.random() * 1.5, flickerSpeed: 2 + Math.random() * 3, colorShiftSpeed: 0.3 + Math.random() * 0.7, timeOffset: Math.random() * Math.PI * 2
            };

            sunData.set(sun.uuid, {
                light: sunLight, shock: shockSphere, isExploding: false, isMain: isMain, basePos: new THREE.Vector3(x, y, z), instability: instability, material: sunMat, shockWaveStartTime: 0
            });

            gsap.to(sun.scale, { x: 80, y: 80, duration: 8, ease: "power2.out" });
            gsap.to(sunLight, { intensity: 2, duration: 8, ease: "power2.out" });
        }

        function createShootingStar() {
            const geometry = new THREE.BufferGeometry();
            const length = 3 + Math.random() * 2;
            const vertices = new Float32Array([ 0, 0, 0, 0, -length, 0 ]);
            geometry.setAttribute('position', new THREE.BufferAttribute(vertices, 3));
            const material = new THREE.LineBasicMaterial({ color: new THREE.Color().setHSL(0.6, 0.8, 0.9), transparent: true, opacity: 1, blending: THREE.AdditiveBlending, linewidth: 3 });
            const shootingStar = new THREE.Line(geometry, material);
            const startX = (Math.random() - 0.5) * 150;
            const startY = 100 + Math.random() * 30;
            const startZ = -30 + (Math.random() - 0.5) * 20;
            shootingStar.position.set(startX, startY, startZ);
            shootingStar.rotation.z = (Math.random() - 0.5) * Math.PI;
            scene.add(shootingStar);
            const duration = 2 + Math.random();
            gsap.to(shootingStar.position, { x: startX + (Math.random() - 0.5) * 80, y: -100, z: startZ + (Math.random() - 0.5) * 40, duration: duration, ease: "power1.in", onComplete: () => { scene.remove(shootingStar); const index = shootingStars.indexOf(shootingStar); if (index > -1) { shootingStars.splice(index, 1); } } });
            gsap.to(shootingStar.material, { opacity: 0, duration: duration * 0.6, delay: duration * 0.4 });
            shootingStars.push(shootingStar);
        }

        spawnSun(50, 20, -60, true);

        // STRUCTURE (Static)
        const r1Geo = new THREE.TorusGeometry(12, 0.1, 16, 100); 
        const r1Mat = new THREE.MeshBasicMaterial({ color: 0x3b82f6, wireframe: true, transparent: true, opacity: 0.15 });
        const ring1 = new THREE.Mesh(r1Geo, r1Mat);
        spaceGroup.add(ring1);

        const r2Geo = new THREE.TorusGeometry(9, 0.3, 16, 100);
        const r2Mat = new THREE.PointsMaterial({ color: 0x3b82f6, size: 0.05, transparent: true, opacity: 0.4, blending: THREE.AdditiveBlending });
        const ring2 = new THREE.Points(r2Geo, r2Mat);
        ring2.rotation.x = Math.PI / 1.5;
        spaceGroup.add(ring2);

        camera.position.z = 10;

        // INTERACTIVITY
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();

        window.addEventListener('mousemove', (event) => {
            if (modal.style.display === 'flex') return;
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = - (event.clientY / window.innerHeight) * 2 + 1;
            raycaster.setFromCamera(mouse, camera);
            const isHoveringCard = isEventOnInteractiveElement(event);
            const intersects = raycaster.intersectObjects(suns);
            if (intersects.length > 0 && !isHoveringCard) {
                document.body.style.cursor = 'pointer';
            } else {
                document.body.style.cursor = 'default';
            }
        });

        function isEventOnInteractiveElement(event) {
            let target = event.target;
            
            while (target && target !== document.body) {
                if (target.classList && (
                    target.classList.contains('glass-card') || 
                    target.classList.contains('btn-cv') || 
                    target.classList.contains('footer-btn') ||
                    target.closest('.glass-card') ||
                    target.closest('.btn-cv') || 
                    target.closest('.footer-btn')
                )) {
                    return true;
                }
                target = target.parentElement;
            }
            return false;
        }

        window.addEventListener('click', (event) => {
            if (modal.style.display === 'flex') return;
            if (isEventOnInteractiveElement(event)) return;

            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(suns);

            if (intersects.length > 0) {
                const hitSun = intersects[0].object;
                const data = sunData.get(hitSun.uuid);

                if (data && !data.isExploding) {
                    data.isExploding = true;
                    explosionCounter++;

                    // Animation explosion
                    const shakeTl = gsap.timeline();
                    shakeTl.to(hitSun.scale, { x: 5, y: 5, duration: 1.5, ease: "power2.in" });
                    shakeTl.to(hitSun.material.color, { r: 1, g: 0, b: 0, duration: 1.5 }, 0); 

                    setTimeout(() => {
                        hitSun.scale.set(0,0,0);
                        hitSun.material.color.setHex(0xffffff); 
                        data.shock.material.opacity = 0.8;
                        data.shock.scale.set(1,1,1);
                        data.shockWaveStartTime = Date.now();
                        
                        // Animation de l'onde de choc
                        gsap.to(data.shock.scale, { 
                            x: 200, y: 200, z: 200, duration: 2, ease: "power2.out",
                            onUpdate: function() {
                                // V√©rifier si l'onde de choc est proche de la cam√©ra (scale > 150)
                                const currentScale = data.shock.scale.x;
                                const distanceToCamera = camera.position.distanceTo(data.shock.position);
                                
                                // Le son se d√©clenche quand l'onde de choc est √† mi-chemin (scale ~ 100)
                                // et qu'elle se dirige vers la cam√©ra
                                if (currentScale > 90 && currentScale < 110 && !data.explosionSoundPlayed) {
                                    if (soundManager.enabled && !soundManager.muted) {
                                        soundManager.playExplosion();
                                        data.explosionSoundPlayed = true;
                                    }
                                }
                            }
                        });
                        
                        gsap.to(data.shock.material, { opacity: 0, duration: 2, ease: "power2.out" });

                        const cards = document.querySelectorAll('.glass-card, .xp-item');
                        cards.forEach(card => {
                            gsap.to(card, { backgroundColor: "rgba(255, 255, 255, 0.8)", borderColor: "#ffffff", boxShadow: "0 0 50px white", duration: 0.1, yoyo: true, repeat: 1, onComplete: () => { gsap.to(card, { backgroundColor: "rgba(255, 255, 255, 0.01)", borderColor: "rgba(255, 255, 255, 0.1)", boxShadow: "none", duration: 0.5 }); } });
                            gsap.to(card, { x: (Math.random()-0.5)*60, y: (Math.random()-0.5)*60, rotation: (Math.random()-0.5)*5, duration: 0.1, yoyo: true, repeat: 5, onComplete: () => { gsap.to(card, { x: 0, y: 0, rotation: 0, duration: 0.5 }); } });
                        });

                        gsap.to(camera.position, { x: "+=0.5", y: "+=0.5", duration: 0.05, yoyo: true, repeat: 15, onComplete: () => { camera.position.x = 0; camera.position.y = 0; } });
                        gsap.to(spaceGroup.rotation, { z: "+=0.2", duration: 0.2, yoyo: true, repeat: 3 });

                        if (data.isMain && explosionCounter === 3 && !secondSunSpawned) {
                            setTimeout(() => { spawnSun(-50, 30, -70, false); secondSunSpawned = true; }, 1000);
                        }

                        setTimeout(() => {
                            gsap.to(hitSun.scale, { x: 80, y: 80, duration: 6, ease: "elastic.out(1, 0.3)" });
                            data.isExploding = false;
                            data.explosionSoundPlayed = false; // R√©initialiser pour la prochaine explosion
                        }, 2500);

                    }, 1500);
                }
            }
        });

        const clock = new THREE.Clock();
        function animate() {
            const t = clock.getElapsedTime();
            ring1.rotation.z = t * 0.05; ring1.rotation.x = Math.sin(t * 0.1) * 0.2;
            ring2.rotation.y = t * 0.08; ring2.rotation.z = -t * 0.02;
            starMesh.rotation.y = t * 0.005;

            const currentTime = performance.now();
            if (currentTime - lastShootingStarTime > shootingStarInterval) {
                createShootingStar();
                lastShootingStarTime = currentTime;
            }

            suns.forEach(sun => {
                const data = sunData.get(sun.uuid);
                if (data && !data.isExploding) {
                    const instab = data.instability;
                    const time = t + instab.timeOffset;
                    const scaleVariation = Math.sin(time * instab.pulseSpeed) * 3;
                    sun.scale.x = instab.baseScale + scaleVariation;
                    sun.scale.y = instab.baseScale + scaleVariation;
                    const flicker = 0.7 + 0.3 * Math.sin(time * instab.flickerSpeed) + 0.2 * Math.sin(time * instab.flickerSpeed * 2.3);
                    data.light.intensity = instab.lightIntensity * flicker;
                    const colorShift = 0.9 + 0.1 * Math.sin(time * instab.colorShiftSpeed);
                    const color = new THREE.Color(colorShift, colorShift, 1);
                    data.material.color.copy(color);
                    if (Math.random() > 0.7) {
                        sun.position.x = data.basePos.x + (Math.random() - 0.5) * 0.5;
                        sun.position.y = data.basePos.y + (Math.random() - 0.5) * 0.5;
                    }
                }
            });

            suns.forEach(sun => {
                const data = sunData.get(sun.uuid);
                if (data && data.isExploding && sun.scale.x > 5) {
                    sun.position.x = data.basePos.x + (Math.random() - 0.5) * 1;
                    sun.position.y = data.basePos.y + (Math.random() - 0.5) * 1;
                } else if (data && !data.isExploding) {
                    sun.position.x += (data.basePos.x - sun.position.x) * 0.1;
                    sun.position.y += (data.basePos.y - sun.position.y) * 0.1;
                }
            });

            renderer.render(scene, camera);
            requestAnimationFrame(animate);
        }
        animate();

        // --- SCROLL & SOUND TRIGGER ---
        let hasPlayedStructureSound = false;

        const tl3d = gsap.timeline({ scrollTrigger: { 
            trigger: "body", 
            start: "top top", 
            end: "bottom bottom", 
            scrub: 1,
            onUpdate: (self) => {
                // D√©clencher le son "flyby" quand on commence √† avancer vers la structure (apr√®s 10% de scroll)
                if (self.progress > 0.1 && !hasPlayedStructureSound && soundManager.enabled && !soundManager.muted) {
                    soundManager.playFlyby();
                    hasPlayedStructureSound = true;
                }
                // Reset si on remonte tout en haut
                if (self.progress < 0.05) {
                    hasPlayedStructureSound = false;
                }
            }
        }});
        
        tl3d.to(spaceGroup.rotation, { x: 0.5, y: 0.5 }, 0);
        tl3d.to(camera.position, { z: 6 }, 0); 
        tl3d.to(ring1.material.color, { r: 168/255, g: 85/255, b: 247/255 }, 0);
        tl3d.to(ring2.material.color, { r: 168/255, g: 85/255, b: 247/255 }, 0);

        document.querySelectorAll('.glass-card').forEach(card => {
            gsap.to(card, { scrollTrigger: { trigger: card, start: "top 90%", end: "top 60%", scrub: 1 }, opacity: 1, scale: 1, y: 0, ease: "power2.out" });
        });

        // Sons pour les boutons de navigation
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault(); 
                const targetId = this.getAttribute('href'); 
                if(targetId==='#')return;
                
                // Jouer le son flyby pour la navigation
                if (soundManager.enabled && !soundManager.muted) {
                    soundManager.playFlyby();
                }
                
                gsap.to(window, { duration: 1.5, scrollTo: { y: targetId, autoKill: false }, ease: "power2.inOut" });
            });
        });

        document.getElementById('open-modal-btn').addEventListener('click',()=>{
            modal.style.display='flex';
            body.style.overflow='hidden';
            gsap.to(modal,{opacity:1,duration:0.3});
            gsap.fromTo(".cv-document-wrapper",{scale:0.95,y:30},{scale:1,y:0,duration:0.4,ease:"back.out(1.2)"})
        });
        
        const closeModal=()=>{
            gsap.to(modal,{opacity:0,duration:0.3,onComplete:()=>{modal.style.display='none';body.style.overflow='auto'}});
        };
        
        document.getElementById('close-modal-btn').addEventListener('click',closeModal);
        modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });

        document.getElementById('print-html-btn').addEventListener('click',()=>{
            const c=document.getElementById('printable-area').innerHTML;
            const s=`@page{size:A4;margin:0}body{font-family:'Helvetica',sans-serif;color:#000;margin:0;padding:10mm;zoom:0.8;-webkit-print-color-adjust:exact;background:#fff!important;}h1{margin:0;font-size:2rem;color:#000;text-shadow:none;}h2{font-size:1.1rem;color:#333;text-shadow:none;margin-top:5px;}.cv-section-title{font-weight:bold;text-transform:uppercase;margin:20px 0 10px 0;border-bottom:1px solid #ccc;color:#000;background:none;padding:0;border-left:none;text-shadow:none;}.cv-entry-header{display:flex;justify-content:space-between;font-weight:bold}.cv-job-title{color:#000;text-shadow:none;}.cv-date{color:#000;text-shadow:none;}.cv-company{color:#444;text-shadow:none;}.tag{border:1px solid #666;color:#000;background:none;padding:2px 4px;display:inline-block;border-radius:3px;text-shadow:none;}ul{padding-left:20px;margin:0}li{color:#000;text-shadow:none;}a{color:#000;text-decoration:none;border-bottom:none;}`;
            const w=window.open('','','height=600,width=800');
            w.document.write(`<html><head><title>CV</title><style>${s}</style></head><body>${c}<!-- Code injected by live-server -->`);
            w.document.close();
            setTimeout(()=>{w.print();w.close()},250);
        });

        window.addEventListener('resize', () => { 
            camera.aspect = window.innerWidth / window.innerHeight; 
            camera.updateProjectionMatrix(); 
            renderer.setSize(window.innerWidth, window.innerHeight); 
        });
    </script>
</body>
</html>